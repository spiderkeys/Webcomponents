<link rel="import" href="../polymer/polymer.html">

<dom-module id="orov-thumbsticks">

  <style type="text/css">
    .hidden { display: none }
  </style>

  <template>
    <canvas id="thumbstick-canvas" class="mobile-controls"></canvas>
  </template>

  <script>



    (function ()
    {


      Polymer({
        is: 'orov-thumbsticks',

        properties:
        {
        },

        behaviors: [namespace('behaviors').oROVStandard],

        registerEmitterHanlders: function(emitter)
        {
        },

        //this.fire( 'eventname', { event data } );

        attached: function ()
        {
          // Add required UI elements
          this.canvas = this.$.thumbstick-canvas;
          this.ctx    = this.canvas.getContext('2d');

          // Component variables
          this.touches    = [];

          // Q: Is this legal?
          this.touchable  = 'createTouch' in document;

          this.mouseDown = false;

          // Check for touch capability and register appropriate listeners
          if( this.touchable )
          {
            // Add touch listeners
            this.canvas.addEventListener( 'touchstart', this.onTouchStart, false );
            this.canvas.addEventListener( 'touchmove', this.onTouchMove, false );
            this.canvas.addEventListener( 'touchend', this.onTouchEnd, false );
          }
          else
          {
            // Add mouse listeners
            this.canvas.addEventListener( 'mousedown', this.onMouseDown, false );
            this.canvas.addEventListener( 'mousemove', this.onMouseMove, false );
            this.canvas.addEventListener( 'mouseup', this.onMouseUp, false );
          }


        },

        draw: function ()
        {
          // Clear the canvas
          this.ctx.clearRect( 0, 0, this.canvas.width, this.canvas.height );

          // Handle touch rendering
          if( this.touchable )
          {
            for( var i = 0; i < this.touches.length; i++ )
            {
              var touch = this.touches[ i ];

              this.ctx.beginPath();
              this.ctx.strokeStyle  = "cyan";
              this.ctx.lineWidth    = "6";

              this.ctx.arc( touch.clientX, touch.clientY, 40, 0, Math.PI * 2, true );
              this.ctx.stroke();
            }
          }
          // Handle click rendering
          else
          {
            if( this.mouseDown ) {
              this.ctx.beginPath();
              this.ctx.strokeStyle = "red";
              this.ctx.lineWidth = "6";

              this.ctx.arc(mouseX, mouseY, 40, 0, Math.PI * 2, true);
              this.ctx.stroke();
            }
          }
        },

        onTouchStart: function (e)
        {
          this.touches = e.touches;
        },

        onTouchMove: function (e)
        {
          // Prevent the browser from doing its default thing (scroll, zoom)
          e.preventDefault();
          this.touches = e.touches;
        },

        onTouchEnd: function (e)
        {
          this.touches = e.touches;
        },

        onMouseDown: function (e)
        {
          this.mouseDown = true;
        },

        onMouseMove: function (e)
        {
          mouseX = e.offsetX;
          mouseY = e.offsetY;
        },

        onMouseUp: function (e)
        {
          this.mouseDown = false;
        }
      });
    }());
  </script>
</dom-module>
